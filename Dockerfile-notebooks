FROM ghcr.io/osgeo/gdal:ubuntu-small-latest

# Install system python pip and venv
RUN apt-get update && apt-get -y install python3-pip python3-venv build-essential

# Create a virtual environment
RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"

# Upgrade pip inside venv
RUN pip install --upgrade pip setuptools wheel

# Install your Python dependencies inside the venv
RUN pip install jupyter
RUN pip install rasterio OWSLib GDAL matplotlib netCDF4 numpy
RUN pip install s3fs zarr

# Create notebook directories
RUN mkdir -p /notebooks/notebooks/tmp /notebooks/notebooks/notebook_helpers

# Copy your requirements and install
COPY ./docs/notebook_helpers/requirements.txt /notebooks/notebook_helpers/
WORKDIR /notebooks
RUN pip install -r notebook_helpers/requirements.txt

# Copy notebooks and config
COPY ./docs .
COPY ./config /config

# Set entrypoint
ENTRYPOINT notebook_helpers/run-jupyter-docker

