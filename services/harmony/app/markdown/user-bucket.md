## User Owned Buckets for Harmony Output
Users may store Harmony output directly in their own S3 buckets by specifying the bucket/path
in their requests with the `destinationUrl` parameter. For example

```

{{root}}/{{exampleCollection}}/ogc-api-coverages/1.0.0/collections/bathymetry/coverage/rangeset?concatenate=true&subset=lon(-160%3A160)&subset=lat(-80%3A80)&skipPreview=true&maxResults=1&destinationUrl=3%3A%2F%2Fmy-staging-bucket

```
**Example {{exampleCounter}}** - Request to store output in user owned S3 bucket

would place the output in `s3://my-example-bucket`. Note that ==the value of `destinationUrl` must be a full S3 path and
must be URL encoded.==

Four things are required to enable Harmony to write to your bucket.

1. The bucket must be in the same AWS region as Harmony, i.e., `us-west-2`.
2. The bucket must have ACLs disabled. This is the default for S3 buckets.
3. Harmony must have permission to write to the bucket.
4. Harmony must have permission to check the bucket's location.

Numbers three and four on the list can be accomplished by setting an appropriate bucket policy.
You can obtain a bucket policy for your bucket using the policy generator at
{{root}}/staging-bucket-policy and passing in the `bucketPath` query parameter. For example

[{{root}}/staging-bucket-policy?bucketPath=my-example-bucket]({{root}}/staging-bucket-policy?bucketPath=my-example-bucket)


The `bucketPath` parameter can be one of the following
1. A bucket name, e.g., `my-example-bucket`
2. A bucket name + path, e.g., `my-example-bucket/my/path`
3. A full S3 url with our without a path, e.g., `s3://my-example-bucket/my/path`

The third option is compatible with the `destinationUrl` parameter for requests.

Bucket names must conform to the [AWS bucket naming rules](https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html). The path must conform to the [AWS object key naming guidelines](https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-keys.html). Characters listed under "Characters to Avoid" are not supported.

A sample policy generated by the endpoint is shown below:


```json

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "write permission",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::123456789012:root"
      },
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::my-bucket/*"
    },
    {
      "Sid": "get bucket location permission",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::123456789012:root"
      },
      "Action": "s3:GetBucketLocation",
      "Resource": "arn:aws:s3:::my-bucket"
    }
  ]
}

```
**Example {{exampleCounter}}** - Sample bucket policy to enable writing Harmony output

<br/>
<br/>
